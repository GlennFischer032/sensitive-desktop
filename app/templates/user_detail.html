{% extends "base.html" %}

{% block title %}User Details - Desktop Manager{% endblock %}

{% block content %}
<div class="header-with-button">
    <h2>User Details: {{ user.username }}</h2>
    <div>
        <a href="{{ url_for('users.view_users') }}" class="button secondary">Back to Users</a>
        <form class="inline-form" action="{{ url_for('users.delete_user', username=user.username) }}" method="post" onsubmit="return confirm('Are you sure you want to delete this user?');">
            <button type="submit" class="button danger">Delete User</button>
        </form>
    </div>
</div>

<div class="user-detail-container">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }}">
            <p>{{ message }}</p>
        </div>
        {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="detail-section">
        <h3>Basic Information</h3>
        <div class="detail-grid">
            <div class="detail-item">
                <div class="detail-label">Username</div>
                <div class="detail-value">{{ user.username }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Full Name</div>
                <div class="detail-value">{{ user.name or 'Not set' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Email</div>
                <div class="detail-value">{{ user.email or 'Not set' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Role</div>
                <div class="detail-value">{{ 'Administrator' if user.is_admin else 'Regular User' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Created</div>
                <div class="detail-value">{{ user.created_at|datetime }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Last Login</div>
                <div class="detail-value">{{ user.last_login|datetime or 'Never' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Organization</div>
                <div class="detail-value">
                    {{ user.organization or 'Not set' }}
                </div>
            </div>
        </div>
    </div>

    <div class="detail-section">
        <h3>OIDC Information</h3>
        <div class="detail-grid">
            <div class="detail-item">
                <div class="detail-label">Subject (sub)</div>
                <div class="detail-value">
                    {% if user.sub %}
                    <span class="oidc-id">{{ user.sub }}</span>
                    {% else %}
                    <span class="not-set">Not set</span>
                    {% endif %}
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Given Name</div>
                <div class="detail-value">{{ user.given_name or 'Not set' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Family Name</div>
                <div class="detail-value">{{ user.family_name or 'Not set' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Email Verified</div>
                <div class="detail-value">
                    {% if user.email_verified %}
                    <span class="verified">Yes</span>
                    {% else %}
                    <span class="not-verified">No</span>
                    {% endif %}
                </div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Locale</div>
                <div class="detail-value">{{ user.locale or 'Not set' }}</div>
            </div>
        </div>
    </div>

    <div class="detail-section">
        <h3>User Connections</h3>
        <div class="connections-list">
            {% if user_connections %}
            <table>
                <thead>
                    <tr>
                        <th>Connection Name</th>
                        <th>Desktop Configuration</th>
                        <th>Created</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for connection in user_connections %}
                    <tr>
                        <td>{{ connection.name }}</td>
                        <td>{{ connection.desktop_configuration_name or "Default" }}</td>
                        <td>{{ connection.created_at|datetime }}</td>
                        <td>
                            {% if connection.is_stopped %}
                            <span class="status-badge stopped">Stopped</span>
                            {% else %}
                            <span class="status-badge active">Active</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty-state">
                <p>No connections found for this user.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}
