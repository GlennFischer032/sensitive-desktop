# Common configuration values
common:
  # Security contexts applied at the Pod level
  podSecurityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault
    fsGroupChangePolicy: OnRootMismatch
    fsGroup: 1000

  # Common container security settings
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL

  # Common service ports
  ports:
    api: 80
    frontend: 80
    guacamole: 80
    guacd: 4822
    postgres: 5432
    redis: 6379

  # Database configuration
  database:
    host: postgres-guacamole
    port: "5432"
    user: "" # Set the database user
    password: "" # Set the database password
    database: desktop_manager # Main database name

  # Credentials and secrets
  credentials:
    secretKey: "" # Set a secure secret key for the application
    guacamoleAdmin:
      username: "" # Set the Guacamole admin username
      password: "" # Set the Guacamole admin password
    desktopAdmin:
      username: "" # Set the Desktop Manager admin username
      password: "" # Set the Desktop Manager admin password
    guacamoleJsonSecretKey: "" # Set the Guacamole JSON secret key

  # Rancher configuration
  rancher:
    apiUrl: "" # Set your Rancher API URL
    clusterId: "" # Set your Rancher cluster ID
    repoName: "" # Set your repository name
    token: "" # Set your Rancher API token
    namespace: "" # Set your namespace

  # OIDC Configuration
  oidc:
    clientId: "" # Set your OIDC client ID
    clientSecret: "" # Set your OIDC client secret
    providerUrl: "" # Set your OIDC provider URL
    redirectUri: "" # Set your OIDC redirect URI
    backendRedirectUri: "" # Set your OIDC backend redirect URI
    frontendUrl: "" # Set your frontend URL

  # Social Auth Configuration
  socialAuth:
    oidcProviderUrl: "" # Set your Social Auth OIDC provider URL
    loginRedirectUrl: "" # Set your Social Auth login redirect URL
    loginErrorUrl: "" # Set your Social Auth login error URL
    oidcCallbackUrl: "" # Set your Social Auth OIDC callback URL
    oidcFrontendRedirectUri: "" # Set your Social Auth OIDC frontend redirect URI
# Component-specific configurations
replicaCount: 1

#####################################################
# Desktop Manager API values
#####################################################
desktopApi:
  replicaCount: 1
  image: "glennfischer032/desktop-manager-api:latest" # Update with specific version if needed
  containerPort: 5000
  healthcheck:
    enabled: true
    path: /api/health
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

#####################################################
# Desktop Manager Frontend values
#####################################################
desktopFrontend:
  replicaCount: 1
  image: "glennfischer032/desktop-manager-frontend:latest" # Update with specific version if needed
  containerPort: 5000
  healthcheck:
    enabled: true
    path: /
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

#####################################################
# PostgreSQL values
#####################################################
postgres:
  image: "postgres:16-alpine"
  initdbImage: "glennfischer032/guacamole-init-db:latest"
  persistence:
    enabled: true
    storageClass: "nfs-csi"
    accessMode: ReadWriteOnce
    size: 1Gi
  healthcheck:
    enabled: true
    command: ["pg_isready", "-U", "$(POSTGRES_USER)", "-d", "$(POSTGRES_DB)"]
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 5

#####################################################
# guacd values
#####################################################
guacd:
  image: "guacamole/guacd"
  logLevel: "info"

#####################################################
# guacamole (web app) values
#####################################################
guacamole:
  image: "glennfischer032/guac-no-root:latest"
  containerPort: 8080
  extensionPriority: "postgresql,json"

#####################################################
# Redis values
#####################################################
redis:
  image: "redis:7-alpine"
  containerPort: 6379
  healthcheck:
    enabled: true
    command: ["redis-cli", "ping"]
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3
